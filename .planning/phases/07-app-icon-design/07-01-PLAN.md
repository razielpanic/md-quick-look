---
phase: 07-app-icon-design
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/generate-icon.sh
  - scripts/icon_master_1024.png
  - scripts/AppIcon.iconset/
autonomous: true

must_haves:
  truths:
    - "1024x1024 master icon exists with star/# composition"
    - "Frosted glass effect visible on symbols"
    - "Purple gradient background renders correctly"
    - "All 10 required icon sizes exist (16, 32, 64, 128, 256, 512, 1024 at 1x and 2x)"
  artifacts:
    - path: "scripts/generate-icon.sh"
      provides: "Icon generation script using ImageMagick"
      min_lines: 30
    - path: "scripts/icon_master_1024.png"
      provides: "Master icon at 1024x1024 resolution"
    - path: "scripts/AppIcon.iconset/"
      provides: "Complete iconset with all required PNG sizes"
  key_links:
    - from: "generate-icon.sh"
      to: "icon_master_1024.png"
      via: "ImageMagick composite operations"
      pattern: "magick.*composite"
    - from: "icon_master_1024.png"
      to: "AppIcon.iconset/"
      via: "sips resize commands"
      pattern: "sips -z"
---

<objective>
Create the master app icon with star/octothorpe composition and frosted glass aesthetic, then generate all required macOS icon sizes.

Purpose: Deliver the visual identity for MD Quick Look - a tribute to Daring Fireball that communicates markdown preview functionality through iconic symbols.

Output: Master 1024x1024 PNG and complete iconset with all 10 required sizes ready for Assets.xcassets integration.
</objective>

<execution_context>
@/Users/razielpanic/.claude/get-shit-done/workflows/execute-plan.md
@/Users/razielpanic/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-app-icon-design/07-CONTEXT.md
@.planning/phases/07-app-icon-design/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create icon generation script</name>
  <files>scripts/generate-icon.sh</files>
  <action>
Create a shell script at `scripts/generate-icon.sh` that uses ImageMagick to generate the app icon.

**Design specifications (from CONTEXT.md - LOCKED):**
- Visual metaphor: Unicode star (★) overlapping with markdown octothorpe (#)
- Composition: Tight crop with carved-out/cutout effect (# cuts through star)
- Style: Frosted glass with background blur effect
- Background: Monochromatic purple gradient (subtle variation)
- Symbol color: White/light with frosted translucency

**Implementation note (re: CONTEXT.md "SF Symbols as foundation"):**
The locked decision mentioned SF Symbols as a possible foundation. For this implementation, we use ImageMagick to directly render the Unicode star (★) and octothorpe (#) characters at high resolution. This is an acceptable implementation because:
1. SF Symbols don't include the Daring Fireball star or markdown octothorpe as distinct symbols
2. Unicode characters rendered via ImageMagick achieve the same visual effect
3. The "foundation" concept is satisfied by using standard typographic symbols as the base design elements

**Recommended purple palette (from RESEARCH.md):**
- Gradient start: #6B46C1 (Purple 600)
- Gradient end: #553C9A (Purple 700)
- Frosted symbols: White at 80-90% opacity with blur

**Cutout/carved effect implementation (CRITICAL):**
To achieve the "# cuts through star" carved-out effect, use ImageMagick alpha compositing:
- Use `-compose Dst_Out` to knock out/carve the # shape from the star
- OR use `-compose Src_Over` with the # having semi-transparent areas to create depth
- OR create layered approach: background → star with blur → # overlay with `-compose Dst_Out` for carved portions

Recommended approach for carved effect:
```bash
# Create star shape, then composite # with knockout
magick ... -compose Dst_Out -composite ...
```
The Dst_Out compose mode removes (knocks out) the source shape from the destination, creating the carved/cutout visual effect.

**Script should:**
1. Check for ImageMagick installation (exit with helpful message if missing)
2. Create output directory if needed
3. Generate 1024x1024 master icon:
   - Draw purple gradient background (diagonal, start to end)
   - Draw large star symbol (★) in white with blur for frosted effect
   - Draw octothorpe (#) using `-compose Dst_Out` to carve through the star
   - Apply tight crop framing (fragments of both symbols visible)
4. Resize master to all required sizes using sips
5. Create AppIcon.iconset folder with proper file naming

**Size mappings (exact file names required):**
- icon_16x16.png (16px), icon_16x16@2x.png (32px)
- icon_32x32.png (32px), icon_32x32@2x.png (64px)
- icon_128x128.png (128px), icon_128x128@2x.png (256px)
- icon_256x256.png (256px), icon_256x256@2x.png (512px)
- icon_512x512.png (512px), icon_512x512@2x.png (1024px)

**ImageMagick techniques for frosted glass:**
- Use `-blur 0x10` or `-gaussian-blur 0x15` for frosted effect
- Layer symbols with `-compose Over -composite` for standard layering
- Use `-compose Dst_Out -composite` for knockout/carved effect
- Use `-gravity center` for positioning
- Consider `-modulate` for adjusting symbol brightness

Make the script executable and self-documenting with comments.
  </action>
  <verify>
`ls -la scripts/generate-icon.sh` shows executable script exists.
`head -20 scripts/generate-icon.sh` shows shebang and purpose comments.
`grep -c "Dst_Out\|compose" scripts/generate-icon.sh` returns > 0 (confirms cutout technique).
  </verify>
  <done>
Shell script exists at scripts/generate-icon.sh with ImageMagick commands for icon generation including cutout/carved effect implementation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Generate master icon and verify quality</name>
  <files>scripts/icon_master_1024.png</files>
  <action>
Run the icon generation script to create the master 1024x1024 icon.

```bash
cd /Users/razielpanic/Projects/md-spotlighter
chmod +x scripts/generate-icon.sh
./scripts/generate-icon.sh
```

After generation, verify the master icon:
1. Check file exists and has reasonable size (should be 50KB-500KB for PNG)
2. Verify dimensions are exactly 1024x1024 using `sips -g pixelWidth -g pixelHeight`
3. Verify PNG format and alpha channel

If ImageMagick is not installed, install it via Homebrew:
```bash
brew install imagemagick
```

**Iteration approach (if needed):**
If the initial icon doesn't look right, adjust the script parameters:
- Blur intensity (sigma value) for frosted effect
- Symbol positioning and scale
- Gradient angle/intensity
- Crop bounds for tight framing
- Dst_Out compose intensity for carved effect depth

The goal is a premium, sophisticated icon that's recognizable at small sizes.
  </action>
  <verify>
`ls -la scripts/icon_master_1024.png` shows file exists with size > 10KB.
`sips -g pixelWidth -g pixelHeight scripts/icon_master_1024.png` shows 1024x1024.
  </verify>
  <done>
Master icon exists at scripts/icon_master_1024.png, is 1024x1024 pixels, and is a valid PNG.
  </done>
</task>

<task type="auto">
  <name>Task 3: Generate all required icon sizes</name>
  <files>scripts/AppIcon.iconset/</files>
  <action>
The generation script should have already created the iconset, but verify and ensure all sizes exist.

If iconset wasn't created by the script, create it manually:

```bash
cd /Users/razielpanic/Projects/md-spotlighter/scripts
mkdir -p AppIcon.iconset

MASTER="icon_master_1024.png"

# Generate all required sizes
sips -z 16 16 "$MASTER" --out "AppIcon.iconset/icon_16x16.png"
sips -z 32 32 "$MASTER" --out "AppIcon.iconset/icon_16x16@2x.png"
sips -z 32 32 "$MASTER" --out "AppIcon.iconset/icon_32x32.png"
sips -z 64 64 "$MASTER" --out "AppIcon.iconset/icon_32x32@2x.png"
sips -z 128 128 "$MASTER" --out "AppIcon.iconset/icon_128x128.png"
sips -z 256 256 "$MASTER" --out "AppIcon.iconset/icon_128x128@2x.png"
sips -z 256 256 "$MASTER" --out "AppIcon.iconset/icon_256x256.png"
sips -z 512 512 "$MASTER" --out "AppIcon.iconset/icon_256x256@2x.png"
sips -z 512 512 "$MASTER" --out "AppIcon.iconset/icon_512x512.png"
sips -z 1024 1024 "$MASTER" --out "AppIcon.iconset/icon_512x512@2x.png"
```

Verify all 10 files exist with correct dimensions:
- icon_16x16.png (16x16)
- icon_16x16@2x.png (32x32)
- icon_32x32.png (32x32)
- icon_32x32@2x.png (64x64)
- icon_128x128.png (128x128)
- icon_128x128@2x.png (256x256)
- icon_256x256.png (256x256)
- icon_256x256@2x.png (512x512)
- icon_512x512.png (512x512)
- icon_512x512@2x.png (1024x1024)

**Small size legibility check:**
View the 16x16 and 32x32 icons. If the design is unrecognizable at these sizes, note this for potential simplification in a future iteration (but proceed with scaled versions for now).
  </action>
  <verify>
`ls scripts/AppIcon.iconset/*.png | wc -l` returns 10.
`sips -g pixelWidth scripts/AppIcon.iconset/icon_16x16.png` returns 16.
`sips -g pixelWidth scripts/AppIcon.iconset/icon_512x512@2x.png` returns 1024.
  </verify>
  <done>
AppIcon.iconset directory contains all 10 required icon files with correct dimensions.
  </done>
</task>

</tasks>

<verification>
All icon generation complete:
1. scripts/generate-icon.sh exists and is executable
2. scripts/icon_master_1024.png exists at 1024x1024
3. scripts/AppIcon.iconset/ contains all 10 icon sizes
4. File naming matches macOS iconset requirements exactly
5. Cutout/carved effect technique implemented using ImageMagick compositing
</verification>

<success_criteria>
- Master 1024x1024 icon generated with star/# frosted glass design
- Carved-out effect implemented using proper ImageMagick compose modes
- All 10 required icon sizes generated via sips
- Icons ready for Assets.xcassets integration in Plan 07-02
</success_criteria>

<output>
After completion, create `.planning/phases/07-app-icon-design/07-01-SUMMARY.md`
</output>
