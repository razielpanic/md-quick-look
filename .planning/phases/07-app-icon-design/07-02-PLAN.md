---
phase: 07-app-icon-design
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset/Contents.json
  - MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset/*.png
  - MDQuickLook/MDQuickLook.xcodeproj/project.pbxproj
autonomous: false

must_haves:
  truths:
    - "Assets.xcassets exists in host app directory"
    - "AppIcon.appiconset contains all icons and valid Contents.json"
    - "Xcode project references Assets.xcassets in build"
    - "Built app shows custom icon in Finder"
    - "Built app shows custom icon in Dock when launched"
  artifacts:
    - path: "MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset/Contents.json"
      provides: "Asset catalog manifest for app icon"
      contains: '"idiom" : "mac"'
    - path: "MDQuickLook/MDQuickLook/Assets.xcassets/Contents.json"
      provides: "Root asset catalog manifest"
    - path: "MDQuickLook/MDQuickLook.xcodeproj/project.pbxproj"
      provides: "Updated Xcode project with Assets.xcassets reference"
      contains: "Assets.xcassets"
  key_links:
    - from: "Assets.xcassets"
      to: "project.pbxproj"
      via: "PBXFileReference and PBXResourcesBuildPhase"
      pattern: "Assets\\.xcassets"
    - from: "Contents.json"
      to: "icon_*.png"
      via: "filename references in images array"
      pattern: '"filename".*icon_'
---

<objective>
Integrate the generated icon into the Xcode project's asset catalog and verify it appears correctly in Finder and Dock.

Purpose: Complete the icon integration so MD Quick Look displays its custom icon throughout macOS - in Applications folder, Get Info, Dock, and (later) About window.

Output: Working Assets.xcassets with app icon, updated Xcode project, and verified icon display.
</objective>

<execution_context>
@gsd:workflows/execute-plan.md
@gsd:templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-app-icon-design/07-CONTEXT.md
@.planning/phases/07-app-icon-design/07-RESEARCH.md
@.planning/phases/07-app-icon-design/07-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Assets.xcassets structure with Contents.json</name>
  <files>
MDQuickLook/MDQuickLook/Assets.xcassets/Contents.json
MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset/Contents.json
MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset/*.png
  </files>
  <action>
Create the Assets.xcassets folder structure in the host app directory.

**Directory structure to create:**
```
MDQuickLook/MDQuickLook/
└── Assets.xcassets/
    ├── Contents.json
    └── AppIcon.appiconset/
        ├── Contents.json
        ├── icon_16x16.png
        ├── icon_16x16@2x.png
        ├── icon_32x32.png
        ├── icon_32x32@2x.png
        ├── icon_128x128.png
        ├── icon_128x128@2x.png
        ├── icon_256x256.png
        ├── icon_256x256@2x.png
        ├── icon_512x512.png
        └── icon_512x512@2x.png
```

**Step 1: Create directories**
```bash
mkdir -p "./MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset"
```

**Step 2: Create root Contents.json**
Create `MDQuickLook/MDQuickLook/Assets.xcassets/Contents.json`:
```json
{
  "info" : {
    "author" : "xcode",
    "version" : 1
  }
}
```

**Step 3: Create AppIcon.appiconset/Contents.json**
Create `MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset/Contents.json`:
```json
{
  "images" : [
    {
      "filename" : "icon_16x16.png",
      "idiom" : "mac",
      "scale" : "1x",
      "size" : "16x16"
    },
    {
      "filename" : "icon_16x16@2x.png",
      "idiom" : "mac",
      "scale" : "2x",
      "size" : "16x16"
    },
    {
      "filename" : "icon_32x32.png",
      "idiom" : "mac",
      "scale" : "1x",
      "size" : "32x32"
    },
    {
      "filename" : "icon_32x32@2x.png",
      "idiom" : "mac",
      "scale" : "2x",
      "size" : "32x32"
    },
    {
      "filename" : "icon_128x128.png",
      "idiom" : "mac",
      "scale" : "1x",
      "size" : "128x128"
    },
    {
      "filename" : "icon_128x128@2x.png",
      "idiom" : "mac",
      "scale" : "2x",
      "size" : "128x128"
    },
    {
      "filename" : "icon_256x256.png",
      "idiom" : "mac",
      "scale" : "1x",
      "size" : "256x256"
    },
    {
      "filename" : "icon_256x256@2x.png",
      "idiom" : "mac",
      "scale" : "2x",
      "size" : "256x256"
    },
    {
      "filename" : "icon_512x512.png",
      "idiom" : "mac",
      "scale" : "1x",
      "size" : "512x512"
    },
    {
      "filename" : "icon_512x512@2x.png",
      "idiom" : "mac",
      "scale" : "2x",
      "size" : "512x512"
    }
  ],
  "info" : {
    "author" : "xcode",
    "version" : 1
  }
}
```

**Step 4: Copy icon files from scripts/AppIcon.iconset/**
```bash
cp ./scripts/AppIcon.iconset/*.png \
   "./MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset/"
```

Verify all 10 PNG files are copied and Contents.json files are valid JSON.
  </action>
  <verify>
`ls MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset/*.png | wc -l` returns 10.
`cat MDQuickLook/MDQuickLook/Assets.xcassets/AppIcon.appiconset/Contents.json | python3 -m json.tool` succeeds (valid JSON).
  </verify>
  <done>
Assets.xcassets folder exists with AppIcon.appiconset containing all 10 icons and valid Contents.json manifests.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Xcode project to include Assets.xcassets</name>
  <files>MDQuickLook/MDQuickLook.xcodeproj/project.pbxproj</files>
  <action>
Update the Xcode project file to reference the new Assets.xcassets folder.

**Required changes to project.pbxproj:**

1. **Add PBXFileReference for Assets.xcassets:**
   In the `/* Begin PBXFileReference section */`:
   ```
   ASSETS_UUID /* Assets.xcassets */ = {isa = PBXFileReference; lastKnownFileType = folder.assetcatalog; path = Assets.xcassets; sourceTree = "<group>"; };
   ```
   Generate a unique UUID (use format like existing UUIDs in file, e.g., 7A1A1A1A1A1A1A1A1A1A1A1A).

2. **Add Assets.xcassets to MDQuickLook group:**
   Find the MDQuickLook group (contains main.swift, Info.plist) and add the Assets.xcassets reference to its children array.

3. **Add to Resources build phase:**
   Find or create `/* Resources */` PBXResourcesBuildPhase for the main app target.
   Add a PBXBuildFile entry:
   ```
   BUILD_FILE_UUID /* Assets.xcassets in Resources */ = {isa = PBXBuildFile; fileRef = ASSETS_UUID /* Assets.xcassets */; };
   ```
   Add this UUID to the files array in the Resources build phase.

4. **Set ASSETCATALOG_COMPILER_APPICON_NAME:**
   In the build settings for the main app target, ensure:
   ```
   ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon;
   ```

**Alternative approach (simpler):**
If modifying project.pbxproj directly is complex, open Xcode briefly:
```bash
open ./MDQuickLook/MDQuickLook.xcodeproj
```
Then:
1. Drag Assets.xcassets into MDQuickLook group in Project Navigator
2. Ensure "Copy items if needed" is unchecked (files already in place)
3. Ensure target "MDQuickLook" is checked
4. Save and close Xcode

After either approach, verify the project.pbxproj contains Assets.xcassets references.
  </action>
  <verify>
`grep -c "Assets.xcassets" MDQuickLook/MDQuickLook.xcodeproj/project.pbxproj` returns > 0.
`grep "ASSETCATALOG_COMPILER_APPICON_NAME" MDQuickLook/MDQuickLook.xcodeproj/project.pbxproj` shows AppIcon setting.
  </verify>
  <done>
Xcode project references Assets.xcassets and is configured to use AppIcon for the app icon.
  </done>
</task>

<task type="auto">
  <name>Task 3: Build app and verify icon integration</name>
  <files>(build output)</files>
  <action>
Build the app and verify the icon is integrated correctly.

**Build the app:**
```bash
cd .
make clean
make build
```

Or via xcodebuild:
```bash
xcodebuild -project MDQuickLook/MDQuickLook.xcodeproj \
           -scheme MDQuickLook \
           -configuration Release \
           -derivedDataPath build \
           clean build
```

**Verify build succeeds without asset catalog errors.**

If build fails with asset catalog errors:
- Check Contents.json syntax (must be valid JSON)
- Verify all referenced filenames match actual files
- Ensure no duplicate entries

**Locate built app:**
The .app should be in `build/Build/Products/Release/MDQuickLook.app` or similar.

**Verify icon is embedded:**
```bash
ls -la "build/Build/Products/Release/MDQuickLook.app/Contents/Resources/AppIcon.icns" 2>/dev/null || \
ls -la "build/Build/Products/Release/MDQuickLook.app/Contents/Resources/"
```

The app should contain either AppIcon.icns or Assets.car (compiled asset catalog).
  </action>
  <verify>
`make build` or `xcodebuild` completes without errors.
App bundle contains icon resources (AppIcon.icns or Assets.car exists).
  </verify>
  <done>
App builds successfully with icon integrated into the bundle.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete app icon integration: star/# frosted glass icon with purple gradient, integrated into Xcode project, built into app bundle.
  </what-built>
  <how-to-verify>
1. **Verify icon in Finder:**
   - Open Finder and navigate to the built app (likely in build/Build/Products/Release/)
   - Look at MDQuickLook.app - it should display the custom purple star/# icon
   - Right-click > Get Info - icon should appear in info window

2. **Verify icon in Dock:**
   - Double-click MDQuickLook.app to launch
   - Look at the Dock - the app icon should be the custom purple star/# design
   - Note: The app may quit immediately (minimal main.swift), that's OK for icon verification

3. **Evaluate icon quality:**
   - Does the purple gradient look premium?
   - Is the frosted glass effect visible?
   - Are the star and # symbols recognizable?
   - Does it look good at the Dock size?

4. **Check small size legibility (optional):**
   - In Finder, switch to list view
   - Can you tell it's a purple icon with the symbols?

**Note on About window verification:**
About window icon display is intentionally NOT verified in this phase. The About window requires additional app UI implementation (NSAboutPanelOptionApplicationIcon or standard About panel setup) which is out of scope for this icon asset integration phase. About window verification will be addressed in Phase 8+ when app UI features are implemented. This aligns with ROADMAP.md success criteria: "Icon will be available for About window and DMG background (verified in Phase 8+)".
  </how-to-verify>
  <resume-signal>
Type "approved" if the icon looks good in Finder and Dock.

If issues, describe what needs adjustment:
- "blur too strong" - reduce frosted effect intensity
- "colors off" - adjust purple gradient values
- "symbols unclear" - adjust composition/positioning
- "too small illegible" - may need simplified small-size variants
  </resume-signal>
</task>

</tasks>

<verification>
Icon integration complete:
1. Assets.xcassets exists with proper structure
2. Contents.json manifests are valid
3. All 10 icon sizes present in appiconset
4. Xcode project references Assets.xcassets
5. App builds without asset catalog errors
6. Icon visible in Finder and Dock (human verified)
7. About window verification deferred to Phase 8+ (per ROADMAP.md)
</verification>

<success_criteria>
- Assets.xcassets integrated into MDQuickLook host app
- Xcode project configured with ASSETCATALOG_COMPILER_APPICON_NAME = AppIcon
- Built app displays custom icon in Finder
- Built app displays custom icon in Dock
- Human has verified icon quality and approved
- About window display deferred to Phase 8+ (documented)
</success_criteria>

<output>
After completion, create `.planning/phases/07-app-icon-design/07-02-SUMMARY.md`
</output>
