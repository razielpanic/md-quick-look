---
phase: 04-performance-and-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - md-spotlighter/MDQuickLook/PreviewViewController.swift
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User sees prominent visual indicator when file content is truncated"
    - "Truncation message is clearly distinct from document content"
    - "File size is displayed in the truncation notice"
  artifacts:
    - path: "md-spotlighter/MDQuickLook/PreviewViewController.swift"
      provides: "Visually distinct truncation message"
      contains: "⚠️"
  key_links:
    - from: "PreviewViewController.swift"
      to: "truncation message"
      via: "string append in large file handling"
      pattern: "truncated\\.append"
---

<objective>
Fix truncation message visibility so users can clearly identify when markdown content has been truncated.

Purpose: UAT testing revealed the plain text truncation message blends in with content, making it impossible to distinguish from actual document text.

Output: Modified PreviewViewController.swift with visually prominent truncation indicator using warning emoji and bold markdown formatting.
</objective>

<execution_context>
@/Users/razielpanic/.claude/get-shit-done/workflows/execute-plan.md
@/Users/razielpanic/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-performance-and-polish/04-01-SUMMARY.md
@.planning/phases/04-performance-and-polish/04-UAT.md
@md-spotlighter/MDQuickLook/PreviewViewController.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update truncation message with visual prominence</name>
  <files>md-spotlighter/MDQuickLook/PreviewViewController.swift</files>
  <action>
    Modify the truncation message in PreviewViewController.swift (line 53) to be visually distinct:

    Current format:
    ```swift
    truncated.append("\n\n---\n\nContent truncated (file is \(sizeStr))")
    ```

    New format:
    ```swift
    truncated.append("\n\n---\n\n⚠️ **Content truncated** — This file is \(sizeStr). Showing first 500 KB.")
    ```

    The changes provide:
    1. Warning emoji (⚠️) as immediate visual indicator that draws attention
    2. Bold markdown formatting (**Content truncated**) for emphasis when rendered
    3. Clear explanation of what was shown ("Showing first 500 KB")
    4. Em dash separator (—) for better visual hierarchy
    5. More explicit wording that explains the truncation

    The markdown renderer will apply bold styling to the **Content truncated** text, making it stand out from the Lorem ipsum or other content above.
  </action>
  <verify>
    1. Build the extension: `cd /Users/razielpanic/Projects/md-spotlighter && xcodebuild -scheme MDQuickLook -configuration Release`
    2. Create a large test file: `python3 -c "print('# Large Test File\n\n' + 'Lorem ipsum dolor sit amet. ' * 20000)" > /tmp/large-test.md`
    3. Verify file is over 500KB: `ls -la /tmp/large-test.md`
    4. Visual test: Quick Look the file in Finder and scroll to bottom - should see ⚠️ emoji and bold "Content truncated" message
  </verify>
  <done>
    Truncation message displays with:
    - Warning emoji (⚠️) visible at start of message
    - Bold "Content truncated" text rendered prominently
    - File size displayed (e.g., "608 KB")
    - Clear explanation "Showing first 500 KB"
    - Message is immediately distinguishable from document content
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Visually prominent truncation message with warning emoji and bold text</what-built>
  <how-to-verify>
    1. Create a large markdown file:
       ```
       python3 -c "print('# Large Test File\n\n' + 'Lorem ipsum dolor sit amet. ' * 20000)" > ~/Desktop/large-test.md
       ```
    2. Open Finder to ~/Desktop
    3. Select large-test.md and press Spacebar for Quick Look
    4. Scroll to the bottom of the preview
    5. Verify you see:
       - A horizontal rule (---)
       - Warning emoji (⚠️)
       - Bold text "Content truncated"
       - File size information
       - "Showing first 500 KB" explanation
    6. Confirm the truncation message is clearly distinguishable from the Lorem ipsum content above it
  </how-to-verify>
  <resume-signal>Type "approved" if truncation message is clearly visible and distinct, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- Build completes without errors
- Large files (>500KB) display truncation message with ⚠️ emoji
- Truncation message renders with bold formatting
- Message is immediately identifiable as a system notice, not document content
</verification>

<success_criteria>
- User can easily identify when viewing truncated content
- Warning emoji provides instant visual recognition
- Bold text reinforces the message prominence
- File size and truncation amount are clearly communicated
</success_criteria>

<output>
After completion, create `.planning/phases/04-performance-and-polish/04-03-SUMMARY.md`
</output>
