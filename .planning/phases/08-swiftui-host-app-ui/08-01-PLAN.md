---
phase: 08-swiftui-host-app-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - MDQuickLook/MDQuickLook/MDQuickLookApp.swift
  - MDQuickLook/MDQuickLook/main.swift
autonomous: true

must_haves:
  truths:
    - "App launches with SwiftUI lifecycle instead of bare NSApplication"
    - "User can access Settings/Preferences from menu bar (Cmd+,)"
    - "User can access About window from menu bar"
    - "User can access Help link from menu bar"
  artifacts:
    - path: "MDQuickLook/MDQuickLook/MDQuickLookApp.swift"
      provides: "SwiftUI App entry point with scene declarations"
      contains: "@main"
    - path: "MDQuickLook/MDQuickLook/main.swift"
      provides: "Deleted or empty (replaced by @main)"
      exists: false
  key_links:
    - from: "MDQuickLookApp.swift"
      to: "Settings scene"
      via: "Scene declaration"
      pattern: "Settings\\s*\\{"
    - from: "MDQuickLookApp.swift"
      to: "Window scenes"
      via: "Window declarations for About and FirstLaunch"
      pattern: "Window\\("
---

<objective>
Create SwiftUI App entry point with scene declarations and menu bar customization.

Purpose: Replace bare NSApplication.shared.run() with proper SwiftUI App lifecycle. This establishes the foundation for all UI windows and menu bar items. The host app becomes a real SwiftUI application rather than a minimal shell.

Output: MDQuickLookApp.swift with @main entry point, Settings scene for Preferences, Window scenes for About and FirstLaunch, and custom menu bar items (About, Preferences, Help, Quit).
</objective>

<execution_context>
@gsd:workflows/execute-plan.md
@gsd:templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-swiftui-host-app-ui/08-CONTEXT.md
@.planning/phases/08-swiftui-host-app-ui/08-RESEARCH.md
@MDQuickLook/MDQuickLook/main.swift
@MDQuickLook/MDQuickLook/Info.plist
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SwiftUI App entry point</name>
  <files>MDQuickLook/MDQuickLook/MDQuickLookApp.swift</files>
  <action>
Create MDQuickLookApp.swift with:

1. Import SwiftUI
2. @main struct MDQuickLookApp: App conformance
3. @AppStorage("hasLaunchedBefore") for first-launch detection
4. @Environment(\.openWindow) for programmatic window opening

Scene declarations in body:
- Settings { SettingsView() } - Creates Preferences menu item automatically
- Window("About MD Quick Look", id: "about") with placeholder EmptyView()
- Window("Welcome", id: "firstLaunch") with placeholder EmptyView()

Use .commands modifier to add custom menu bar:
- CommandGroup(replacing: .appInfo) for custom About item that opens "about" window
- CommandGroup(replacing: .help) for Help link that opens GitHub README in browser

Add .task modifier on a hidden WindowGroup to handle first-launch logic:
- If !hasLaunchedBefore: open "firstLaunch" window, set hasLaunchedBefore = true
- If hasLaunchedBefore: open Settings window (Preferences)

Window modifiers for About and FirstLaunch:
- .windowResizability(.contentSize)
- .restorationBehavior(.disabled)
- .windowMinimizeBehavior(.disabled) for About only

NOTE: Use placeholder EmptyView() for window contents - actual views created in Plan 08-02.
NOTE: Use openURL environment for Help link: URL(string: "https://github.com/razielpanic/md-quick-look")
  </action>
  <verify>
File exists at MDQuickLook/MDQuickLook/MDQuickLookApp.swift with @main attribute. Build with:
xcodebuild -project MDQuickLook/MDQuickLook.xcodeproj -scheme MDQuickLook -configuration Release build 2>&1 | tail -20
Should succeed (views are placeholders but valid SwiftUI).
  </verify>
  <done>MDQuickLookApp.swift exists with @main, Settings scene, two Window scenes (about, firstLaunch), and custom Commands for About and Help menu items.</done>
</task>

<task type="auto">
  <name>Task 2: Remove old main.swift entry point</name>
  <files>MDQuickLook/MDQuickLook/main.swift</files>
  <action>
Delete MDQuickLook/MDQuickLook/main.swift entirely.

The @main attribute in MDQuickLookApp.swift replaces the need for main.swift. Having both causes duplicate symbol errors.

Update Xcode project to remove main.swift reference:
1. The file reference 2B1B1B1B1B1B1B1B1B1B1B1B (main.swift) should be removed from project.pbxproj
2. The build file 2A1A1A1A1A1A1A1A1A1A1A1A (main.swift in Sources) should be removed

Use sed or direct project.pbxproj editing to remove these references. Safer to:
1. Remove the file from disk: rm MDQuickLook/MDQuickLook/main.swift
2. Use xcodebuild - it will warn about missing file but still build if MDQuickLookApp.swift is present

The project cleanup can be done by opening Xcode or manually editing pbxproj, but for this task just delete the file. Xcode handles missing files gracefully.
  </action>
  <verify>
File does not exist: ls MDQuickLook/MDQuickLook/main.swift should fail.
Build still succeeds:
xcodebuild -project MDQuickLook/MDQuickLook.xcodeproj -scheme MDQuickLook -configuration Release build 2>&1 | grep -E "(BUILD SUCCEEDED|error:)"
Should show BUILD SUCCEEDED.
  </verify>
  <done>main.swift deleted, app builds using @main from MDQuickLookApp.swift.</done>
</task>

<task type="auto">
  <name>Task 3: Clean up Xcode project references</name>
  <files>MDQuickLook/MDQuickLook.xcodeproj/project.pbxproj</files>
  <action>
Add MDQuickLookApp.swift to Xcode project and remove stale main.swift reference.

1. Add file reference for MDQuickLookApp.swift to PBXFileReference section
2. Add build file reference for MDQuickLookApp.swift to PBXBuildFile section
3. Add MDQuickLookApp.swift to the MDQuickLook group (children array)
4. Add MDQuickLookApp.swift to Sources build phase
5. Remove main.swift file reference (2B1B1B1B1B1B1B1B1B1B1B1B)
6. Remove main.swift build file (2A1A1A1A1A1A1A1A1A1A1A1A)

Use consistent UUID pattern for new entries (e.g., AA1A1A1A1A1A1A1A1A1A1A1A for file ref, AB1A1A1A1A1A1A1A1A1A1A1A for build file).

After editing, verify build:
xcodebuild -project MDQuickLook/MDQuickLook.xcodeproj -scheme MDQuickLook -configuration Release build 2>&1 | grep -E "(BUILD SUCCEEDED|error:)"
  </action>
  <verify>
Build succeeds without warnings about missing main.swift:
xcodebuild -project MDQuickLook/MDQuickLook.xcodeproj -scheme MDQuickLook -configuration Release build 2>&1 | grep -v "warning:" | grep -E "(BUILD SUCCEEDED|error:)"
MDQuickLookApp.swift appears in project file:
grep "MDQuickLookApp.swift" MDQuickLook/MDQuickLook.xcodeproj/project.pbxproj
  </verify>
  <done>Xcode project updated with MDQuickLookApp.swift, main.swift references removed, build succeeds cleanly.</done>
</task>

</tasks>

<verification>
1. MDQuickLookApp.swift exists with @main attribute
2. main.swift is deleted
3. Project builds without errors:
   xcodebuild -project MDQuickLook/MDQuickLook.xcodeproj -scheme MDQuickLook -configuration Release build
4. App launches (will show empty windows but that's expected - views added in 08-02)
</verification>

<success_criteria>
- MDQuickLookApp.swift is the app entry point (@main)
- Settings scene declared (Preferences menu item works)
- Window scenes declared for "about" and "firstLaunch"
- Custom Commands for About and Help menu items
- Build succeeds without main.swift
- App uses SwiftUI lifecycle
</success_criteria>

<output>
After completion, create `.planning/phases/08-swiftui-host-app-ui/08-01-SUMMARY.md`
</output>
