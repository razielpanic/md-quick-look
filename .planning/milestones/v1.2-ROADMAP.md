# Milestone v1.2: Rendering Polish & Features

**Status:** SHIPPED 2026-02-07
**Phases:** 11-15
**Total Plans:** 8

## Overview

v1.2 enhances the Quick Look extension's rendering pipeline to handle real-world markdown documents gracefully across all Finder presentation contexts. The journey starts with YAML front matter preprocessing (which must happen before all other parsing), then establishes width-aware layout detection (foundational for downstream rendering), makes tables responsive to available space, adds GFM task list checkboxes as visual elements, and concludes with cross-context integration testing to verify all features work together in spacebar popup, preview pane, and fullscreen Quick Look.

## Phases

### Phase 11: YAML Front Matter

**Goal**: Users see YAML front matter displayed as a clean, styled metadata section instead of garbled markdown artifacts
**Depends on**: Nothing (first phase; preprocessing step that must precede all other pipeline changes)
**Requirements**: YAML-01, YAML-02, YAML-03, YAML-04, YAML-05, YAML-06
**Plans**: 1 plan

Plans:
- [x] 11-01-PLAN.md -- YAML extraction, parsing, styled rendering, and visual verification

**Details:**
- YAML front matter between `---` delimiters detected, extracted, and displayed as styled metadata section
- Key-value parsing with list value support (brackets stripped, comma-separated)
- Two-column layout for 4+ pairs using tab stops
- Rounded background with tertiarySystemFill and bottom separator
- Long values truncated with ellipsis
- Array of tuples preserves YAML key ordering

### Phase 12: Layout & Sizing

**Goal**: The extension adapts its rendering to the available width, producing readable output whether in a spacebar popup, narrow Finder preview pane, or fullscreen Quick Look
**Depends on**: Phase 11 (clean markdown pipeline established)
**Requirements**: LAYOUT-01, LAYOUT-02, LAYOUT-03, LAYOUT-04
**Plans**: 2 plans

Plans:
- [x] 12-01-PLAN.md -- WidthTier enum, width-aware MarkdownRenderer and TableRenderer
- [x] 12-02-PLAN.md -- PreviewViewController wiring, LayoutManager adaptation, visual verification

**Details:**
- Two-tier breakpoint system (narrow <320pt, normal >=320pt) matching Quick Look's actual usage contexts
- Headings shrink 30-40% in narrow mode while body text shrinks 14%
- YAML field capping: max 5 fields in narrow mode with "+N more" indicator
- 640pt max content width cap for fullscreen readability
- Regenerate content only on tier change, not every bounds update
- Fixed pre-existing bug: inline code backgrounds applied at wrong offset after list prefix insertion

### Phase 13: Table Rendering

**Goal**: Tables remain readable and properly sized in any Quick Look context, from narrow preview pane to fullscreen
**Depends on**: Phase 12 (requires availableWidth parameter from layout detection)
**Requirements**: TABLE-01, TABLE-02, TABLE-03, TABLE-04, TABLE-05
**Plans**: 2 plans

Plans:
- [x] 13-01-PLAN.md -- Available-width pipeline, content-proportional column sizing, compact mode
- [x] 13-02-PLAN.md -- Smart wrap/truncate hybrid, table spacing, build verification

**Details:**
- availableWidth threaded from PreviewViewController through MarkdownRenderer to TableRenderer
- Content-proportional column sizing: 7-step algorithm with min/max enforcement
- Compact mode (narrow tier): 11pt font, 2pt padding, 1pt header border
- Normal mode caps table width at 640pt to match body content width
- Smart wrap/truncate: rows default to truncation, wrap only when >50% cells overflow
- 3-line cap prevents excessively tall rows
- Unbreakable string detection (URLs, paths, long identifiers)

### Phase 14: Task List Checkboxes

**Goal**: GFM task list items render as visual checkboxes that match native macOS appearance
**Depends on**: Phase 11 (clean markdown for AST parsing), Phase 12 (width-aware rendering context)
**Requirements**: TASK-01, TASK-02, TASK-03, TASK-04, TASK-05, TASK-06
**Plans**: 1 plan

Plans:
- [x] 14-01-PLAN.md -- Task list preprocessing, SF Symbol checkbox rendering, visual verification

**Details:**
- `- [ ]` renders as empty `circle` SF Symbol, `- [x]` as filled `checkmark.circle.fill`
- Checkboxes use system accent blue via hierarchicalColor, baseline-aligned with text
- Mixed lists correctly show bullets for regular items, checkboxes for task items
- Code fence state machine prevents checkbox conversion inside code blocks
- Identity-aware list prefix deduplication for nested lists

### Phase 15: Cross-Context Integration

**Goal**: All v1.2 features work together correctly across every Quick Look presentation context
**Depends on**: Phase 14 (all features implemented)
**Requirements**: LAYOUT-05
**Plans**: 2 plans

Plans:
- [x] 15-01-PLAN.md -- Snapshot test infrastructure, test target setup, comprehensive test file
- [x] 15-02-PLAN.md -- Record baselines, visual defect review, rendering fixes, verification

**Details:**
- MDQuickLookTests target with swift-snapshot-testing 1.18.9
- CrossContextSnapshotTests: 6 snapshot tests (260px/500px/800px x light/dark)
- Comprehensive test markdown file exercising all v1.2 features together
- 0.98 precision tolerance for snapshot comparison
- Extension sources compiled directly in test target (Option C workaround for SPM C module issue)
- Full 3000px height snapshots capture complete document content

---

## Milestone Summary

**Key Decisions:**
- Two-tier breakpoint system (narrow/normal) instead of smooth scaling
- Disproportionate heading scaling (30-40% reduction vs 14% body)
- Content-proportional table column sizing with content-fitted behavior
- Circle SF Symbol checkboxes (not square) per user preference
- swift-snapshot-testing 1.18.9 for visual regression testing
- Option C (compile extension sources in test target) for app extension testing

**Issues Resolved:**
- Inline code backgrounds applied at wrong character range after list prefix insertion
- YAML front matter tab stops too wide causing value truncation
- Nested list prefix deduplication broken with same-ordinal parent/child items
- Wrapped text misalignment with text start for checkbox items
- Snapshot height insufficient to capture full document content

**Issues Deferred:**
- MIT license attribution in app UI (deferred to future UI milestone)
- Preferences toggle for YAML front matter display (requires App Group infrastructure)
- Dark mode background color inconsistency across sections (minor visual polish)

**Technical Debt Incurred:**
- Test target workaround: extension sources compiled directly into test target due to known Xcode/SPM C module transitive dependency limitation
- Documentation drift: REQUIREMENTS.md says square checkboxes but implementation uses circle per user decision

---

_For current project status, see .planning/PROJECT.md_
